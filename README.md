# DoodleDuel - محرر السيناريو الذكي

## نظرة عامة على المشروع (Project Overview)

DoodleDuel هو تطبيق ويب متقدم مصمم ليكون محرر سيناريو ذكي. يوفر التطبيق بيئة تحرير متطورة تقوم تلقائيًا بتحليل وتنسيق نصوص السيناريو بمجرد لصقها في المحرر. الهدف هو تبسيط عملية كتابة السيناريو من خلال أتمتة التنسيق، مما يسمح للكتاب بالتركيز على الإبداع بدلاً من القواعد الفنية للتنسيق.

## بنية الواجهة الخلفية (Backend Architecture)

تم بناء الواجهة الخلفية باستخدام Node.js و Express، وهي مصممة للعمل بكفاءة في بيئات التطوير والإنتاج.

- **نقطة الدخول (`index.ts`):** هي قلب الواجهة الخلفية، حيث يتم إعداد خادم Express. يقوم هذا الملف بالتمييز بين بيئة التطوير والإنتاج:
    - **في التطوير:** يتم دمج خادم تطوير Vite كـ middleware، مما يتيح ميزات مثل التحديث السريع (HMR) لتجربة تطوير سلسة.
    - **في الإنتاج:** يتم تصدير التطبيق كـ Firebase Function، مما يجعله قابلاً للتطوير وقوياً.

- **المسارات (`routes.ts`):** هذا الملف مسؤول عن تعريف جميع نقاط النهاية (API) التي تبدأ بالمسار `/api`. حاليًا، البنية التحتية للمسارات جاهزة ولكن لا توجد نقاط نهاية محددة بعد.

- **التخزين (`storage.ts`):** يستخدم التطبيق واجهة `IStorage` لتجريد منطق التخزين. التطبيق الحالي هو `MemStorage`، وهو حل تخزين مؤقت في الذاكرة. هذا الحل مثالي لمراحل التطوير والاختبار، ولكنه غير مناسب للإنتاج حيث يتطلب حلاً دائماً لتخزين البيانات.

## بنية الواجهة الأمامية (Frontend Architecture)

الواجهة الأمامية مبنية باستخدام React وتتبع أحدث الممارسات في تطوير واجهات المستخدم الحديثة.

- **الهيكل العام (`main.tsx`, `App.tsx`):** التطبيق عبارة عن Single Page Application (SPA) يستخدم `wouter` لإدارة التوجيه. المسار الرئيسي `/` يعرض المكون الأساسي وهو محرر السيناريو. تم إعداد `React Query` لإدارة حالة الخادم بكفاءة، على الرغم من عدم استخدامه حاليًا.

- **المكون الرئيسي (`ScreenplayEditor.tsx`):** هو واجهة المستخدم الرئيسية للتطبيق. إنه محرر نصوص غني بالميزات يقوم بتحليل وتنسيق نص السيناريو تلقائيًا عند اللصق. يستخدم `MutationObserver` لمراقبة التغييرات في المحتوى وترقيم الصفحات ديناميكيًا، مما يوفر تجربة تحرير تشبه معالجات النصوص التقليدية.

- **منطق الأعمال (`ScreenplayCoordinator.ts`):** هذا هو العقل المدبر لمعالجة النصوص في طرف العميل. يعمل بالكامل في المتصفح دون الحاجة إلى استدعاءات للخادم. يستخدم سلسلة من "الوكلاء" (`agents.ts`) الذين يستخدمون تعابير نمطية (Regex) لتحديد وتنسيق كل نوع من سطور السيناريو (مثل عنوان المشهد، الحوار، الشخصية، الإجراء).

## كيف يعمل (How it Works)

يعتمد التطبيق بشكل أساسي على منطق قوي في طرف العميل لمعالجة النصوص، مما يجعله سريعًا وفعالًا.

1.  **لصق النص:** عندما يقوم المستخدم بلصق نص سيناريو غير منسق في `ScreenplayEditor`.
2.  **بدء المعالجة:** يقوم المحرر بتمرير النص إلى `ScreenplayCoordinator`.
3.  **تحديد الأنماط:** يقوم `ScreenplayCoordinator` بتشغيل سلسلة من "الوكلاء" (`agents.ts`) على النص. كل وكيل مسؤول عن تحديد نوع معين من الأسطر (مشهد، شخصية، حوار، إلخ) باستخدام تعابير نمطية محددة مسبقًا.
4.  **تطبيق التنسيق:** بمجرد أن يحدد الوكيل نوع السطر، يتم تطبيق أنماط CSS المناسبة عليه لتنسيقه وفقًا لمعايير كتابة السيناريو.
5.  **عرض النتيجة:** يتم عرض النص المنسق فورًا في المحرر، مع ترقيم الصفحات تلقائيًا.

هذه العملية تتم بالكامل في المتصفح، مما يوفر استجابة فورية ويقلل من الحمل على الخادم. البنية التحتية للواجهة الخلفية جاهزة لدعم ميزات مستقبلية مثل حفظ السيناريوهات ومشاركتها.
